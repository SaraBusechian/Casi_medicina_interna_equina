<!DOCTYPE html>
<html lang="it">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Caso Clinico Interattivo: Malattia Respiratoria Bovina</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
    <style>
        body {
            font-family: 'Inter', sans-serif;
        }
        .screen { display: none; }
        .active-screen { display: block; }
        .answer-btn:disabled {
            opacity: 0.7;
            cursor: not-allowed;
        }
        .correct {
            background-color: #dcfce7 !important;
            border-color: #22c55e !important;
        }
        .incorrect {
            background-color: #fee2e2 !important;
            border-color: #ef4444 !important;
        }
        .modal {
            display: none; /* Hidden by default */
            position: fixed; /* Stay in place */
            z-index: 50; /* Sit on top */
            left: 0;
            top: 0;
            width: 100%; /* Full width */
            height: 100%; /* Full height */
            overflow: auto; /* Enable scroll if needed */
            background-color: rgba(0,0,0,0.6); /* Black w/ opacity */
            padding-top: 60px;
        }
        .modal-content {
            background-color: #fefefe;
            margin: 5% auto;
            padding: 2rem;
            border: 1px solid #888;
            width: 80%;
            max-width: 700px;
            border-radius: 1rem;
            position: relative;
        }
        .close-btn {
            color: #aaa;
            position: absolute;
            top: 10px;
            right: 25px;
            font-size: 28px;
            font-weight: bold;
            cursor: pointer;
        }
        .close-btn:hover,
        .close-btn:focus {
            color: black;
            text-decoration: none;
            cursor: pointer;
        }
        @media print {
            body * {
                visibility: hidden;
            }
            #printable-brd-sheet, #printable-brd-sheet * {
                visibility: visible;
            }
            #printable-brd-sheet {
                position: absolute;
                left: 0;
                top: 0;
                width: 100%;
            }
            .no-print {
                display: none;
            }
        }
    </style>
</head>
<body class="bg-gray-100 text-gray-800 flex items-center justify-center min-h-screen p-4">

    <div id="main-container" class="bg-white p-6 sm:p-8 rounded-2xl shadow-2xl max-w-4xl w-full transition-all duration-500">

        <!-- Schermata Iniziale -->
        <div id="start-screen" class="screen active-screen text-center">
            <div class="flex justify-center mb-4">
                <svg class="w-16 h-16 text-blue-600" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor">
                    <path stroke-linecap="round" stroke-linejoin="round" d="M12 7.5h1.5m-1.5 3h1.5m-7.5 3h7.5m-7.5 3h7.5m3-9h3.375c.621 0 1.125.504 1.125 1.125V18a2.25 2.25 0 0 1-2.25 2.25M16.5 7.5V18a2.25 2.25 0 0 0 2.25 2.25M16.5 7.5V4.875c0-.621-.504-1.125-1.125-1.125H4.125C3.504 3.75 3 4.254 3 4.875V18a2.25 2.25 0 0 0 2.25 2.25h13.5M6 7.5h3v3H6v-3Z" />
                </svg>
            </div>
            <h1 class="text-3xl font-bold text-gray-900 mb-2">Caso Clinico Interattivo</h1>
            <p class="text-xl text-gray-600 mb-6">Un Caso Clinico nel Vitellone da Carne</p>
            <p class="mb-8 max-w-2xl mx-auto">Sei il veterinario responsabile di un allevamento. Un allevatore ti chiama per un problema respiratorio in un lotto di vitelloni appena arrivati. Segui il caso, analizza i dati e metti alla prova le tue capacità diagnostiche.</p>
            <button id="start-btn" class="bg-blue-600 text-white font-bold py-3 px-8 rounded-lg shadow-md hover:bg-blue-700 transition-transform transform hover:scale-105">Inizia il Caso</button>
        </div>

        <!-- Schermata Anamnesi -->
        <div id="anamnesi-screen" class="screen">
            <h2 class="text-2xl font-bold mb-4 border-b pb-2">1. Anamnesi e Segnalamento</h2>
            <div class="space-y-4 text-gray-700 leading-relaxed">
                <p><strong>Gruppo interessato:</strong> Lotto di 50 vitelloni maschi di razza Limousine e meticci, età media 6 mesi, peso medio 250 kg.</p>
                <p><strong>Storia recente:</strong> Acquistati una settimana fa da un centro di raccolta, hanno affrontato un viaggio di 8 ore. Sono stati raggruppati animali di diversa provenienza. Lo stato vaccinale è sconosciuto e non è stata fatta metafilassi all'arrivo.</p>
                <p><strong>Motivo della chiamata:</strong> L'allevatore è preoccupato per un numero crescente di animali (10-12/50) con depressione, anoressia e scolo nasale. I sintomi sono comparsi ieri sera e sono peggiorati stamattina.</p>
            </div>
            <div class="text-center mt-8">
                <button id="anamnesi-btn" class="bg-blue-600 text-white font-bold py-3 px-8 rounded-lg shadow-md hover:bg-blue-700 transition-transform transform hover:scale-105">Procedi con la Visita Clinica</button>
            </div>
        </div>

        <!-- Schermata Esame Clinico -->
        <div id="esame-clinico-screen" class="screen">
            <h2 class="text-2xl font-bold mb-4 border-b pb-2">2. Esame Clinico</h2>
            <div class="grid md:grid-cols-2 gap-6 text-gray-700 leading-relaxed">
                <div>
                    <h3 class="font-semibold text-lg mb-2 text-gray-800">Esame a distanza (sul gruppo)</h3>
                    <ul class="list-disc list-inside space-y-2">
                        <li>Circa 1/4 del gruppo si isola, letargico, con testa e orecchie basse.</li>
                        <li><strong>Tachipnea</strong> evidente in molti soggetti.</li>
                        <li><strong>Dispnea</strong> con respiro addominale in 2-3 casi gravi.</li>
                        <li>Tosse umida e debole.</li>
                        <li>Scolo nasale da sieroso a mucopurulento.</li>
                    </ul>
                </div>
                <div class="space-y-3">
                    <h3 class="font-semibold text-lg mb-2 text-gray-800">Esame ravvicinato (soggetto n. 74)</h3>
                     <p><strong>Temperatura:</strong> <span class="font-bold text-red-600">40.5°C</span></p>
                    <p><strong>Frequenza cardiaca:</strong> 110 bpm</p>
                    <p><strong>Frequenza respiratoria:</strong> <span class="font-bold text-red-600">80 atti/min</span></p>
                    <p><strong>Auscultazione toracica (aree cranio-ventrali):</strong> Presenza di <strong>rantoli umidi e sibili</strong>. Murmure vescicolare ridotto in alcune aree.</p>
                    <p><strong>Stato di idratazione:</strong> Lieve disidratazione (5-6%).</p>
                </div>
            </div>
             <div class="text-center mt-8">
                <button id="esame-clinico-btn" class="bg-green-600 text-white font-bold py-3 px-8 rounded-lg shadow-md hover:bg-green-700 transition-transform transform hover:scale-105">Hai tutti i dati. Inizia il Quiz!</button>
            </div>
        </div>
        
        <!-- Schermata Quiz -->
        <div id="quiz-screen" class="screen">
            <div class="mb-4">
                <p id="question-counter" class="text-sm text-gray-500 font-medium">Domanda 1 di 10</p>
                <div class="w-full bg-gray-200 rounded-full h-2.5 mt-1">
                    <div id="progress-bar" class="bg-blue-600 h-2.5 rounded-full" style="width: 10%"></div>
                </div>
            </div>
            <h2 id="question-text" class="text-xl font-bold mb-6"></h2>
            <div id="answer-buttons" class="grid grid-cols-1 md:grid-cols-2 gap-4">
                <!-- I bottoni delle risposte saranno inseriti qui da JS -->
            </div>
            <div id="rationale-container" class="mt-6 p-4 bg-blue-50 border-l-4 border-blue-500 text-blue-800 rounded-r-lg hidden">
                <h4 class="font-bold">Spiegazione</h4>
                <p id="rationale-text"></p>
            </div>
            <div class="text-right mt-6">
                <button id="next-btn" class="bg-gray-800 text-white font-bold py-2 px-6 rounded-lg shadow-md hover:bg-gray-900 transition-transform transform hover:scale-105 hidden">Prossima Domanda</button>
            </div>
        </div>

        <!-- Schermata Risultati -->
        <div id="results-screen" class="screen text-center">
            <h2 class="text-3xl font-bold text-gray-900 mb-4">Quiz Completato!</h2>
            <p class="text-xl text-gray-600 mb-6">Ecco il tuo punteggio:</p>
            <div id="score-circle" class="relative w-40 h-40 mx-auto flex items-center justify-center bg-gray-100 rounded-full mb-6">
                <span id="final-score" class="text-4xl font-bold text-gray-800"></span>
            </div>
            <p id="score-message" class="text-lg mb-8 max-w-xl mx-auto"></p>
            <div class="flex flex-col sm:flex-row gap-4 justify-center">
                <button id="restart-btn" class="bg-blue-600 text-white font-bold py-3 px-6 rounded-lg shadow-md hover:bg-blue-700 transition-transform transform hover:scale-105">Riprova il Caso</button>
                <button id="summary-btn" class="bg-gray-700 text-white font-bold py-3 px-6 rounded-lg shadow-md hover:bg-gray-800 transition-transform transform hover:scale-105">Riepilogo del Caso</button>
                <button id="brd-sheet-btn" class="bg-teal-600 text-white font-bold py-3 px-6 rounded-lg shadow-md hover:bg-teal-700 transition-transform transform hover:scale-105">Scheda sulla BRD</button>
            </div>
        </div>

    </div>

    <!-- Modale Riepilogo Caso -->
    <div id="summary-modal" class="modal">
        <div class="modal-content">
            <span id="close-summary-btn" class="close-btn">&times;</span>
            <h2 class="text-2xl font-bold mb-4 border-b pb-2">Riepilogo del Caso Clinico</h2>
            <div class="space-y-3 text-gray-700 text-left">
                <p><strong>Segnalamento:</strong> 50 vitelloni (Limousine/meticci), 6 mesi, 250 kg.</p>
                <p><strong>Anamnesi Chiave:</strong> Arrivati da 1 settimana, stress da trasporto (8h), mescolamento di gruppi, nessuna metafilassi all'arrivo.</p>
                <p><strong>Sintomi:</strong> Morbilità del 20-25%. Esordio acuto con depressione, anoressia, scolo nasale, tosse.</p>
                <p><strong>Reperti Clinici Salienti:</strong> Ipertermia grave (40.5°C), Tachipnea grave (80 atti/min), rantoli umidi e sibili all'auscultazione delle aree cranio-ventrali.</p>
                <p><strong>Diagnosi Finale:</strong> Complesso della Malattia Respiratoria Bovina (BRD), con probabile eziologia mista (infezione virale primaria e sovrainfezione batterica da *Mannheimia haemolytica*).</p>
                <p><strong>Approccio Terapeutico:</strong> Metafilassi antibiotica sull'intero gruppo e somministrazione di FANS ai soggetti con segni clinici evidenti per controllare l'infiammazione e la febbre.</p>
            </div>
        </div>
    </div>

    <!-- Modale Scheda BRD -->
    <div id="brd-sheet-modal" class="modal">
        <div class="modal-content">
            <span id="close-brd-btn" class="close-btn">&times;</span>
            <div id="printable-brd-sheet">
                <h2 class="text-2xl font-bold mb-4 border-b pb-2">Scheda sulla Malattia Respiratoria Bovina (BRD)</h2>
                <div class="space-y-4 text-gray-700 text-left leading-relaxed">
                    <p><strong>Definizione:</strong> La BRD è una sindrome respiratoria multifattoriale, principale causa di morbilità, mortalità e perdite economiche nel bovino da carne, specialmente nella fase di ingrasso.</p>
                    <p><strong>Fattori Predisponenti (Stress):</strong> Trasporto, svezzamento, cambio di alimentazione, mescolamento di animali di diversa provenienza, condizioni ambientali avverse (sovraffollamento, scarsa ventilazione).</p>
                    <div>
                        <strong>Eziologia Complessa:</strong>
                        <ul class="list-disc list-inside ml-4 mt-1">
                            <li><strong>Agenti Virali Primari:</strong> Danneggiano le difese immunitarie locali. I più comuni sono: BHV-1 (IBR), BRSV, PI3, BVDV.</li>
                            <li><strong>Agenti Batterici Secondari:</strong> Colonizzano il polmone danneggiato. I più comuni sono: *Mannheimia haemolytica*, *Pasteurella multocida*, *Histophilus somni*, *Mycoplasma bovis*.</li>
                        </ul>
                    </div>
                    <p><strong>Segni Clinici Cardinali:</strong> Febbre (>39.5°C), depressione ("testa bassa"), anoressia, scolo nasale (da sieroso a purulento), tosse, aumento della frequenza respiratoria (tachipnea) e respirazione difficoltosa (dispnea).</p>
                    <p><strong>Diagnosi:</strong> Si basa su anamnesi e fattori di rischio, esame clinico (con auscultazione e valutazione di score clinici), supportato da diagnostica per immagini (ecografia toracica) e campionamenti (tampone nasale profondo, lavaggio broncoalveolare) per l'identificazione degli agenti patogeni.</p>
                    <p><strong>Terapia e Gestione:</strong>
                        <ul class="list-disc list-inside ml-4 mt-1">
                            <li><strong>Terapia:</strong> Antibiotici a lunga durata d'azione e buona diffusione polmonare.</li>
                            <li><strong>Terapia di supporto:</strong> FANS per ridurre febbre e infiammazione, fluidoterapia se necessario.</li>
                            <li><strong>Gestione del gruppo (Metafilassi):</strong> Trattamento antibiotico di tutto il gruppo a rischio quando la morbilità supera una certa soglia (es. 10-15%).</li>
                        </ul>
                    </p>
                    <p><strong>Prevenzione:</strong> È l'approccio chiave. Si basa su programmi vaccinali mirati, riduzione dei fattori di stress, corretta gestione degli animali all'arrivo (quarantena) e buone pratiche di allevamento.</p>
                </div>
            </div>
            <div class="text-center mt-8 no-print">
                <button id="print-brd-btn" class="bg-green-600 text-white font-bold py-2 px-6 rounded-lg shadow-md hover:bg-green-700">Stampa / Salva PDF</button>
            </div>
        </div>
    </div>


    <script>
        const quizData = [
            {
                question: "Un allevatore ti contatta perché un gruppo di 50 vitelloni da carne di razza Limousine, di circa 6 mesi, arrivati in allevamento da una settimana, presenta alcuni soggetti con depressione, anoressia e scolo nasale. Quale dato anamnestico è più critico per orientare la diagnosi?",
                answers: [
                    "Il recente trasporto e cambio di ambiente.",
                    "Il tipo di lettiera utilizzata nel box.",
                    "La genealogia dei vitelli.",
                    "L'ultima sverminazione effettuata."
                ],
                correct: 0,
                rationale: "Il trasporto è un potente fattore di stress che, insieme al mescolamento di animali di diversa provenienza, è un elemento chiave nello sviluppo della BRD."
            },
            {
                question: "Ti rechi in allevamento. All'esame clinico a distanza di un soggetto sintomatico, noti che mantiene la testa e le orecchie basse. Quale altro segno, osservabile a distanza, è fortemente indicativo di un coinvolgimento respiratorio?",
                answers: [
                    "Tendenza a isolarsi dal gruppo.",
                    "Presenza di diarrea.",
                    "Aumento della frequenza respiratoria a riposo (tachipnea).",
                    "Zoppia a un arto posteriore."
                ],
                correct: 2,
                rationale: "La tachipnea è un meccanismo compensatorio per l'ipossia causata dalla ridotta funzionalità polmonare ed è un segno cardinale di distress respiratorio."
            },
            {
                question: "Procedi con l'esame clinico ravvicinato di un vitello che presenta una temperatura rettale di 40.5°C. Durante l'auscultazione del torace, quali reperti acustici ti aspetti di sentire in caso di broncopolmonite?",
                answers: [
                    "Soffi cardiaci sistolici.",
                    "Rantoli umidi e sibili.",
                    "Murmure vescicolare normale in tutte le aree.",
                    "Assenza completa di suoni respiratori in un'area."
                ],
                correct: 1,
                rationale: "Questi suoni avventizi sono causati dal passaggio di aria attraverso le vie aeree contenenti essudato (rantoli) o ristrette (sibili), tipici della broncopolmonite."
            },
            {
                question: "Sulla base dei dati anamnestici (stress da trasporto) e clinici (febbre, tachipnea, rantoli polmonari), qual è la diagnosi differenziale MENO probabile in questo scenario?",
                answers: [
                    "Complesso della Malattia Respiratoria Bovina (BRD).",
                    "Rinotracheite Infettiva Bovina (IBR).",
                    "Salmonellosi (forma respiratoria).",
                    "Intossicazione acuta da urea."
                ],
                correct: 3,
                rationale: "L'intossicazione da urea provoca segni neurologici acuti (tremori, barcollamento, convulsioni) e morte rapida, un quadro clinico molto diverso."
            },
            {
                question: "Per approfondire la diagnosi, decidi di eseguire un'ecografia toracica. La presenza diffusa di 'linee B' (artefatti a coda di cometa) e aree di consolidamento polmonare ventrali è fortemente suggestiva di quale condizione?",
                answers: [
                    "Enfisema polmonare.",
                    "Quadro polmonare normale.",
                    "Broncopolmonite essudativa.",
                    "Ernia diaframmatica."
                ],
                correct: 2,
                rationale: "Le linee B indicano un aumento del contenuto di liquidi nell'interstizio e/o negli alveoli, e il consolidamento (epatizzazione) è il segno patognomonico della polmonite."
            },
            {
                question: "Per identificare gli agenti eziologici, esegui un lavaggio broncoalveolare (BAL). Quale dei seguenti batteri è considerato il principale responsabile della mortalità e delle lesioni polmonari gravi nella BRD?",
                answers: [
                    "Mannheimia haemolytica.",
                    "Pasteurella multocida.",
                    "Histophilus somni.",
                    "Mycoplasma bovis."
                ],
                correct: 0,
                rationale: "Questo batterio è noto per la sua potente leucotossina, che causa una grave polmonite fibrino-necrotica ed è l'agente più letale nella BRD."
            },
            {
                question: "L'esito del BAL conferma la presenza di *Mannheimia haemolytica* e del Bovine Herpesvirus 1 (BHV-1). Qual è il ruolo più probabile del BHV-1 in questo caso?",
                answers: [
                    "È un contaminante del campione.",
                    "È l'agente della setticemia.",
                    "È l'agente primario che ha danneggiato le difese respiratorie, favorendo l'infezione batterica secondaria.",
                    "Ha causato una mutazione in Mannheimia."
                ],
                correct: 2,
                rationale: "Molti virus della BRD, incluso BHV-1, compromettono l'epitelio respiratorio e la funzione immunitaria locale, aprendo la strada ai batteri."
            },
            {
                question: "La diagnosi è Broncopolmonite da *Mannheimia haemolytica* secondaria a infezione da BHV-1. Poiché più del 20% degli animali mostra segni clinici, quale approccio gestionale è più indicato?",
                answers: [
                    "Trattare solo gli animali con febbre > 41°C.",
                    "Isolare i malati e non trattare il resto del gruppo.",
                    "Eseguire la metafilassi: trattare l'intero gruppo con un antibiotico a lunga azione.",
                    "Vaccinare immediatamente l'intero gruppo."
                ],
                correct: 2,
                rationale: "La metafilassi è il trattamento di un intero gruppo di animali a seguito della diagnosi di infezione in una parte del gruppo, ed è la strategia standard per controllare i focolai di BRD."
            },
            {
                question: "Nella scelta dell'antibiotico per la terapia/metafilassi, quale criterio è FONDAMENTALE per un uso prudente ed efficace?",
                answers: [
                    "Scegliere sempre la molecola più recente.",
                    "Utilizzare una molecola con spettro mirato, lunga durata d'azione e buona penetrazione polmonare.",
                    "Scegliere l'antibiotico con il costo per ml più basso.",
                    "Usare una combinazione di almeno tre antibiotici."
                ],
                correct: 1,
                rationale: "Questi sono i tre pilastri della terapia antibiotica efficace: colpire i patogeni giusti, mantenere concentrazioni efficaci a lungo e raggiungere il sito d'infezione."
            },
            {
                question: "Oltre alla terapia antibiotica, quale misura di supporto è cruciale per la guarigione dei vitelli affetti da BRD?",
                answers: [
                    "Somministrazione di un FANS (Farmaco Antinfiammatorio Non Steroideo).",
                    "Lasciare gli animali nel box principale.",
                    "Forzare l'alimentazione con sonda gastrica.",
                    "Aumentare la densità di animali nel box."
                ],
                correct: 0,
                rationale: "I FANS sono fondamentali per ridurre la febbre, l'infiammazione polmonare e il dolore, migliorando il benessere dell'animale e favorendo la ripresa dell'appetito."
            }
        ];

        let currentQuestionIndex = 0;
        let score = 0;

        const screens = document.querySelectorAll('.screen');
        const startBtn = document.getElementById('start-btn');
        const anamnesiBtn = document.getElementById('anamnesi-btn');
        const esameClinicoBtn = document.getElementById('esame-clinico-btn');
        const nextBtn = document.getElementById('next-btn');
        const restartBtn = document.getElementById('restart-btn');

        const questionCounter = document.getElementById('question-counter');
        const progressBar = document.getElementById('progress-bar');
        const questionText = document.getElementById('question-text');
        const answerButtonsContainer = document.getElementById('answer-buttons');
        const rationaleContainer = document.getElementById('rationale-container');
        const rationaleText = document.getElementById('rationale-text');
        
        const finalScoreEl = document.getElementById('final-score');
        const scoreMessageEl = document.getElementById('score-message');
        
        // Modal elements
        const summaryModal = document.getElementById('summary-modal');
        const brdSheetModal = document.getElementById('brd-sheet-modal');
        const summaryBtn = document.getElementById('summary-btn');
        const brdSheetBtn = document.getElementById('brd-sheet-btn');
        const closeSummaryBtn = document.getElementById('close-summary-btn');
        const closeBrdBtn = document.getElementById('close-brd-btn');
        const printBrdBtn = document.getElementById('print-brd-btn');


        function showScreen(screenId) {
            screens.forEach(screen => {
                screen.classList.remove('active-screen');
            });
            document.getElementById(screenId).classList.add('active-screen');
        }

        function startQuiz() {
            currentQuestionIndex = 0;
            score = 0;
            showScreen('quiz-screen');
            showQuestion();
        }

        function showQuestion() {
            resetState();
            const currentQuestion = quizData[currentQuestionIndex];
            questionText.textContent = currentQuestion.question;
            
            currentQuestion.answers.forEach((answer, index) => {
                const button = document.createElement('button');
                button.innerHTML = answer;
                button.classList.add('answer-btn', 'w-full', 'p-4', 'border-2', 'rounded-lg', 'text-left', 'transition-colors', 'duration-200', 'hover:bg-gray-100', 'hover:border-blue-500');
                button.dataset.index = index;
                button.addEventListener('click', selectAnswer);
                answerButtonsContainer.appendChild(button);
            });

            updateProgress();
        }

        function resetState() {
            while (answerButtonsContainer.firstChild) {
                answerButtonsContainer.removeChild(answerButtonsContainer.firstChild);
            }
            rationaleContainer.classList.add('hidden');
            nextBtn.classList.add('hidden');
        }

        function selectAnswer(e) {
            const selectedBtn = e.target;
            const selectedIndex = parseInt(selectedBtn.dataset.index);
            const correctIndex = quizData[currentQuestionIndex].correct;

            if (selectedIndex === correctIndex) {
                score++;
                selectedBtn.classList.add('correct');
            } else {
                selectedBtn.classList.add('incorrect');
            }
            
            Array.from(answerButtonsContainer.children).forEach(button => {
                if (parseInt(button.dataset.index) === correctIndex) {
                    button.classList.add('correct');
                }
                button.disabled = true;
            });

            rationaleText.textContent = quizData[currentQuestionIndex].rationale;
            rationaleContainer.classList.remove('hidden');
            nextBtn.classList.remove('hidden');
        }
        
        function showNextQuestion() {
            currentQuestionIndex++;
            if (currentQuestionIndex < quizData.length) {
                showQuestion();
            } else {
                showResults();
            }
        }

        function updateProgress() {
            const progress = ((currentQuestionIndex + 1) / quizData.length) * 100;
            questionCounter.textContent = `Domanda ${currentQuestionIndex + 1} di ${quizData.length}`;
            progressBar.style.width = `${progress}%`;
        }
        
        function showResults() {
            const scorePercent = Math.round((score / quizData.length) * 100);
            finalScoreEl.textContent = `${score}/${quizData.length}`;

            let message = '';
            if (scorePercent === 100) {
                message = "Eccellente! Hai dimostrato una profonda conoscenza del caso. Diagnosi perfetta!";
            } else if (scorePercent >= 70) {
                message = "Ottimo lavoro! Hai gestito il caso con competenza, dimostrando un solido ragionamento clinico.";
            } else if (scorePercent >= 50) {
                message = "Buon tentativo. Rivedi le spiegazioni per consolidare i punti in cui hai avuto difficoltà.";
            } else {
                message = "C'è margine di miglioramento. Non arrenderti, ripassa il caso e riprova. Ogni errore è un'opportunità per imparare!";
            }
            scoreMessageEl.textContent = message;

            showScreen('results-screen');
        }

        startBtn.addEventListener('click', () => showScreen('anamnesi-screen'));
        anamnesiBtn.addEventListener('click', () => showScreen('esame-clinico-screen'));
        esameClinicoBtn.addEventListener('click', startQuiz);
        nextBtn.addEventListener('click', showNextQuestion);
        restartBtn.addEventListener('click', () => {
            currentQuestionIndex = 0;
            score = 0;
            showScreen('start-screen');
        });
        
        // Modal listeners
        summaryBtn.onclick = function() {
            summaryModal.style.display = "block";
        }
        brdSheetBtn.onclick = function() {
            brdSheetModal.style.display = "block";
        }
        closeSummaryBtn.onclick = function() {
            summaryModal.style.display = "none";
        }
        closeBrdBtn.onclick = function() {
            brdSheetModal.style.display = "none";
        }
        printBrdBtn.onclick = function() {
            window.print();
        }
        window.onclick = function(event) {
            if (event.target == summaryModal) {
                summaryModal.style.display = "none";
            }
            if (event.target == brdSheetModal) {
                brdSheetModal.style.display = "none";
            }
        }

    </script>
</body>
</html>

